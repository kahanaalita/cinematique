# Rate Limiting Implementation Summary

## ‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π rate limiter –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä–µ–∫–ª–∞–º–Ω—ã—Ö API endpoints –æ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—é (user_id)
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Å–≤–æ–π –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω –∏–ª–∏ Keycloak
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP –∞–¥—Ä–µ—Å—É
- –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∞—Ç–∞–∫
- –£—á–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø—Ä–æ–∫—Å–∏ (X-Forwarded-For, X-Real-IP)
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á: user_id + IP + endpoint

### ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É–≥—Ä–æ–∑
- **–°–ª—É—á–∞–π–Ω—ã–µ/–æ—à–∏–±–æ—á–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏**: –õ–∏–º–∏—Ç 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- **–°–ø–∞–º –æ—Ç –±–æ—Ç–æ–≤**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –í–æ–∑–≤—Ä–∞—Ç 429 Too Many Requests

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Redis –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
```
‚úÖ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é)
‚úÖ TTL –∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
```

### Fixed Window Counter –∞–ª–≥–æ—Ä–∏—Ç–º
```
–ö–ª—é—á: ratelimit:{user_id}:{ip}:{endpoint}:{timestamp_minute}
–ü—Ä–∏–º–µ—Ä: ratelimit:12345:192.168.0.1:/api/movies:202507241004
```

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
1. **INCR** - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
2. **EXPIRE** - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º TTL (60 —Å–µ–∫) –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞** - –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω ‚Üí 429 –æ—à–∏–±–∫–∞
4. **HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–º–∏—Ç–∞—Ö –≤ –æ—Ç–≤–µ—Ç–µ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
internal/ratelimit/
‚îú‚îÄ‚îÄ redis.go          # Redis rate limiter
‚îú‚îÄ‚îÄ middleware.go     # Gin middleware
‚îú‚îÄ‚îÄ client.go         # Redis –∫–ª–∏–µ–Ω—Ç
‚îî‚îÄ‚îÄ redis_test.go     # Unit —Ç–µ—Å—Ç—ã

docs/
‚îî‚îÄ‚îÄ RATE_LIMITING.md  # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

examples/
‚îî‚îÄ‚îÄ rate_limit_example.go  # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

tests/
‚îú‚îÄ‚îÄ test_rate_limit.sh     # –¢–µ—Å—Ç—ã rate limiting
‚îî‚îÄ‚îÄ final_test.sh          # –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=1000
RATE_LIMIT_WINDOW_SECONDS=60
```

### –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º—ã–µ endpoints
```go
RestrictedEndpoints: []string{
    "/api/movies",
    "/api/actors",
}
```

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### Middleware –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```go
// Rate limiting middleware
if cfg.RateLimit.Enabled && rateLimiter != nil {
    router.Use(ratelimit.Middleware(rateLimiter, rateLimitConfig))
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ endpoint
```
GET /api/rate-limit/status?endpoint=/api/movies
```

## üìä HTTP –æ—Ç–≤–µ—Ç—ã

### –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```http
HTTP/1.1 200 OK
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 995
X-RateLimit-Reset: 1706097600
```

### –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
```http
HTTP/1.1 429 Too Many Requests
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1706097600

{
  "error": "Too many requests",
  "message": "Rate limit exceeded. Maximum 1000 requests per 1m0s",
  "current_count": 1001,
  "limit": 1000,
  "window": "1m0s",
  "retry_after": 60
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã
```bash
go test ./internal/ratelimit/...
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
./tests/test_rate_limit.sh
./tests/final_test.sh
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl -H "Authorization: Bearer TOKEN" \
  http://localhost:8080/api/rate-limit/status

# –ú–∞—Å—Å–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
for i in {1..1005}; do
  curl -H "Authorization: Bearer TOKEN" \
    http://localhost:8080/api/movies
done
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏
- `http_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –ª–∏–º–∏—Ç–∞–º–∏

### Grafana –¥–∞—à–±–æ—Ä–¥
- –ì—Ä–∞—Ñ–∏–∫–∏ rate limiting
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π –ª–∏–º–∏—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker Compose
```bash
# –ó–∞–ø—É—Å–∫ Redis
docker-compose up -d redis

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
go run main.go
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
docker-compose logs redis

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl http://localhost:8080/api/movies
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- **Redis**: ~100,000 INCR –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫
- **–ü–∞–º—è—Ç—å**: ~50 –±–∞–π—Ç –Ω–∞ –∫–ª—é—á
- **Latency**: <1ms –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Redis Cluster** –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
- **Sharding** –ø–æ user_id –∏–ª–∏ IP
- **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è** –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ö–æ–¥–∞
- –£—á–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö IP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- JWT + Keycloak –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ò–∑–æ–ª—è—Ü–∏—è –ø–æ endpoints

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- HTTPS –¥–ª—è –∑–∞—â–∏—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

**Rate limiting —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!**

- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—Å–µ—Ö —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —É–≥—Ä–æ–∑
- ‚úÖ –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Redis
- ‚úÖ –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ